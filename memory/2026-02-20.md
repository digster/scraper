# 2026-02-20: Replace go-readability with go-trafilatura

## Summary

Replaced `go-shiori/go-readability` (Mozilla Readability port) with `markusmobius/go-trafilatura` (trafilatura port) for article content extraction. Trafilatura provides better extraction accuracy (0.906 on ScrapingHub benchmark) and richer metadata extraction (title, author, date, language, description, sitename). It uses go-readability and go-domdistiller as fallback extractors.

## Changes Made (20 files)

### Core
- **internal/crawler/storage.go**: Replaced `extractReadableContent()` with `extractContent()` using trafilatura. Added metadata extraction (title, author, date, language, description, sitename) to `.meta.json` files.
- **internal/crawler/config.go**: Renamed `DisableReadability` -> `DisableContentExtraction`
- **internal/crawler/index.go**: Added trafilatura metadata fields to `metaFileData`. Added backward compat `ReadabilityExtracted *bool` for old `.meta.json` files.

### Interfaces (all maintain backward compatibility)
- **cmd/cli/main.go**: `-no-readability` -> `-no-extract` (breaking)
- **internal/api/types.go**: Added `DisableContentExtraction`, kept `DisableReadability` as deprecated alias
- **internal/api/jobs.go**: Handles both fields with `||`
- **internal/mcp/types.go**: Added `DisableContentExtraction`, kept `DisableReadability` as deprecated alias
- **internal/mcp/server.go**: Added `disableContentExtraction` param, kept `disableReadability` as deprecated
- **internal/mcp/tools.go**: Handles both args

### Frontend
- **frontend/src/lib/stores/crawler.js**: `disableReadability` -> `disableContentExtraction`
- **frontend/src/lib/components/ConfigForm.svelte**: Updated tooltip to reference trafilatura

### GUI
- **pkg/app/app.go**: `DisableReadability` -> `DisableContentExtraction` in CrawlConfig and PresetConfig

### Tests
- **internal/crawler/crawler_test.go**: Updated all field references and metadata assertions
- **internal/crawler/index_test.go**: Updated `metaFileData` literals
- **pkg/app/presets_test.go**: Updated field reference

### Documentation
- **README.md**: Updated feature descriptions, CLI flag docs, output structure docs
- **ARCHITECTURE.md**: Updated storage description, config table, dependency table, design decisions
- **docs/skill.md**: Updated MCP parameter docs, CLI flag table, output format description

### Dependencies
- **go.mod/go.sum**: Added go-trafilatura and transitive deps

## Backward Compatibility

| Interface | Old | New | Strategy |
|-----------|-----|-----|----------|
| CLI flag | `-no-readability` | `-no-extract` | Breaking (documented) |
| API JSON | `disableReadability` | `disableContentExtraction` | Both accepted |
| MCP param | `disableReadability` | `disableContentExtraction` | Both accepted |
| meta.json | `readability_extracted` | `content_extracted` | index.go reads both |

## Note
Go module cache had macOS `com.apple.provenance` xattr preventing `go mod download`. User needs to run `go mod download` manually to fetch the new trafilatura dependency before building/testing.
